top_builddir=.

CC=@CC@ @CPPFLAGS@ @CFLAGS@ -fPIC -I. -Isrc -DCHECKS
L=@CC@ -fPIC
A=a
SO=so
AR=ar
RANLIB=@RANLIB@
EXE=@EXEEXT@
LIBS=-lm
O=@OBJEXT@
INSTALL=@INSTALL@
prefix=@prefix@
exec_prefix=@exec_prefix@
includedir=@includedir@
libdir=@libdir@

_SRC = active.c convert.c poly.c wind.c render.c xrow.c stroke.c moments.c dict.c
_OBJS = active.o convert.o poly.o wind.o render.o xrow.o stroke.o moments.o dict.o
OBJS_IN_SRC=$(foreach obj, $(_OBJS), src/$(obj))

EXAMPLES=examples/logo$(EXE)

all: $(OBJS_IN_SRC) libgfxpoly.$(A) libgfxpoly.$(SO)

examples: $(EXAMPLES)

%.o: %.c
	$(CC) -fPIC -c $< -o $@

src/active.o: src/active.c src/active.h src/poly.h
src/convert.o: src/convert.c src/convert.h src/poly.h
src/poly.o: src/poly.c src/poly.h src/active.h src/heap.h
src/wind.o: src/wind.c src/wind.h src/poly.h
src/dict.o: src/dict.c src/dict.h
src/render.o: src/render.c src/wind.h src/poly.h src/render.h
src/xrow.o: src/xrow.c src/xrow.h
src/stroke.o: src/stroke.c src/poly.h src/convert.h src/wind.h
src/moments.o: src/moments.c src/moments.h
src/gfxline.o: src/gfxline.c src/gfxline.h

examples/logo.o: examples/logo.c src/*.h examples/ttf.h
examples/ttf.o: examples/ttf.c examples/ttf.h

libgfxpoly.$(A): $(OBJS_IN_SRC)
	$(AR) cru $@ $(OBJS_IN_SRC)
	$(RANLIB) $@

libgfxpoly.$(SO): $(OBJS_IN_SRC)
	$(L) -shared $(OBJS_IN_SRC) -o $@

examples/logo$(EXE): examples/logo.o examples/ttf.o gfxpoly.$(A)
	$(L) examples/logo.o examples/ttf.o gfxpoly.$(A) -o $@ $(LIBS) -lpdflib

install:
	cp gfxpoly.h $(includedir)
	cp libgfxpoly.$(A) $(libdir)
	cp libgfxpoly.$(SO) $(libdir)

clean: 
	rm -f src/*.o examples/*.o gfxpoly.$(A) gfxpoly.$(SO)
